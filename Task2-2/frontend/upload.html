{% extends "base.html" %}
{% block content %}
<h2>Upload File to Dropbox</h2>
<form method="POST" enctype="multipart/form-data">
  <div class="mb-3">
    <label for="file" class="form-label">Select file</label>
    <input type="file" class="form-control" name="file" id="file" required>

    <label for="folder">Choose folder:</label>
    <select name="folder" id="folder">
      <option value="">/ (root)</option>
    </select>

  </div>
  <button type="submit" class="btn btn-success">Upload</button>
</form>

<script>
async function loadFolders() {
  try {
    const res = await fetch('/api/folders');
    const data = await res.json();
    if (res.ok) {
      const folderSelect = document.getElementById('folder');
      data.folders.forEach(folder => {
        const option = document.createElement('option');
        option.value = folder;
        option.textContent = folder;
        folderSelect.appendChild(option);
      });
    } else {
      alert("Error loading folders: " + data.error);
    }
  } catch (err) {
    alert("Error: " + err);
  }
}

loadFolders();
</script>
{% endblock %}
